(function(c){var a=c.$AreaSalePage;var e={define:function(){Ext.require(["Ext.form.*","Ext.Img","Ext.tip.QuickTipManager","Ext.ux.FieldReplicator"]);Ext.define("Bsh.report.areaSale.IndexView",{extend:"Ext.form.Panel",clearAll:function(g){return function(){g.getForm().reset()}},addExportTab:function(g){return function(){var l=Ext.getCmp("mainTab1");if(l){if(Ext.getCmp("areaSalePageId")){var k=Ext.getCmp("areaSalePageId").getStore();var p=Ext.getCmp("areaSalePageSummaryId").getStore();var i=Ext.getCmp("category").getValue();var q=Ext.getCmp("storeId").getValue();var j=Ext.getCmp("startTime").getRawValue();var m=Ext.getCmp("endTime").getRawValue();var h=Ext.getCmp("is_trade_close").checked;var n=Ext.getCmp("sku").getRawValue();new_params={category1:i,storeId1:q,startTime1:j,endTime1:m,is_trade_close1:h,sku1:n};Ext.apply(k.proxy.extraParams,new_params);k.load();k.on("load",function(s,r,t){if(r.length==0){Ext.Msg.alert("提示信息","无记录!")}else{l.setActiveTab(1);l.show()}});Ext.apply(p.proxy.extraParams,new_params);p.load();l.setActiveTab(1);l.show()}else{var o=e.create_gridBoth();var k=Ext.getCmp("areaSalePageId").getStore();k.on("load",function(s,r,t){if(r.length==0){Ext.Msg.alert("提示信息","无记录!")}else{l.add(o).show()}})}}}},initComponent:function(){var g=this;this.dockedItems=[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"btnEdit",text:"查询",handler:g.addExportTab(this)},{xtype:"button",iconCls:"icon-clearAll",text:"清空",handler:g.clearAll(this)}]}];g.callParent()}});Ext.define("Smartec.page.AreaSale",{extend:"Smartec.reportGrid.Panel",model:AreaSalePage,columns:[{xtype:"rownumberer",text:"序号",width:40,sortable:false},{text:"品类",width:45,sortable:true,dataIndex:"cid"},{text:"型号",width:90,sortable:false,dataIndex:"matrn"},{text:"SAP价",width:45,sortable:false,hidden:true,dataIndex:"price"},{text:" ",sortable:false,hidden:true,dataIndex:"quantity"},{text:"<span style=color:red>浙江</span>",width:46,sortable:true,dataIndex:"pzj",renderer:function(g){if(0==g){return""}else{return g}}},{text:"<span style=color:red>北京</span>",width:46,sortable:true,dataIndex:"pbj",renderer:function(g){if(0==g){return""}else{return g}}},{text:"<span style=color:red>广东</span>",width:46,sortable:true,dataIndex:"pgd",renderer:function(g){if(0==g){return""}else{return g}}},{text:"<span style=color:red>湖北</span>",width:46,sortable:true,dataIndex:"phb",renderer:function(g){if(0==g){return""}else{return g}}},{text:"<span style=color:red>四川</span>",width:46,sortable:true,dataIndex:"psc",renderer:function(g){if(0==g){return""}else{return g}}},{text:"成都",width:30,sortable:true,dataIndex:"cd",renderer:function(g){if(0==g){return""}else{return g}}},{text:"西安",width:30,sortable:true,dataIndex:"xa",renderer:function(g){if(0==g){return""}else{return g}}},{text:"兰州",width:30,sortable:true,dataIndex:"lz",renderer:function(g){if(0==g){return""}else{return g}}},{text:"昆明",width:30,sortable:true,dataIndex:"km",renderer:function(g){if(0==g){return""}else{return g}}},{text:"贵阳",width:30,sortable:true,dataIndex:"gy",renderer:function(g){if(0==g){return""}else{return g}}},{text:"重庆",width:30,sortable:true,dataIndex:"cq",renderer:function(g){if(0==g){return""}else{return g}}},{text:"武汉",width:30,sortable:true,dataIndex:"wh",renderer:function(g){if(0==g){return""}else{return g}}},{text:"南昌",width:30,sortable:true,dataIndex:"nc",renderer:function(g){if(0==g){return""}else{return g}}},{text:"郑州",width:30,sortable:true,dataIndex:"zz",renderer:function(g){if(0==g){return""}else{return g}}},{text:"长沙",width:30,sortable:true,dataIndex:"cs",renderer:function(g){if(0==g){return""}else{return g}}},{text:"北京",width:30,sortable:true,dataIndex:"bj",renderer:function(g){if(0==g){return""}else{return g}}},{text:"太原",width:30,sortable:true,dataIndex:"ty",renderer:function(g){if(0==g){return""}else{return g}}},{text:"济南",width:30,sortable:true,dataIndex:"jn",renderer:function(g){if(0==g){return""}else{return g}}},{text:"石家庄",width:30,sortable:true,dataIndex:"sjz",renderer:function(g){if(0==g){return""}else{return g}}},{text:"沈阳",width:30,sortable:true,dataIndex:"sy",renderer:function(g){if(0==g){return""}else{return g}}},{text:"长春",width:30,sortable:true,dataIndex:"cc",renderer:function(g){if(0==g){return""}else{return g}}},{text:"哈尔滨",width:30,sortable:true,dataIndex:"heb",renderer:function(g){if(0==g){return""}else{return g}}},{text:"杭州",width:30,sortable:true,dataIndex:"hz",renderer:function(g){if(0==g){return""}else{return g}}},{text:"合肥",width:30,sortable:true,dataIndex:"hf",renderer:function(g){if(0==g){return""}else{return g}}},{text:"上海",width:30,sortable:true,dataIndex:"sh",renderer:function(g){if(0==g){return""}else{return g}}},{text:"南京",width:30,sortable:true,dataIndex:"nj",renderer:function(g){if(0==g){return""}else{return g}}},{text:"无锡",width:30,sortable:true,dataIndex:"wx",renderer:function(g){if(0==g){return""}else{return g}}},{text:"宁波",width:30,sortable:true,dataIndex:"nb",renderer:function(g){if(0==g){return""}else{return g}}},{text:"佛山",width:30,sortable:true,dataIndex:"fs",renderer:function(g){if(0==g){return""}else{return g}}},{text:"南宁",width:30,sortable:true,dataIndex:"nn",renderer:function(g){if(0==g){return""}else{return g}}},{text:"福州",width:30,sortable:true,dataIndex:"fz",renderer:function(g){if(0==g){return""}else{return g}}},{text:"深圳",width:30,sortable:true,dataIndex:"sz",renderer:function(g){if(0==g){return""}else{return g}}},{text:"TTL",width:30,sortable:true,dataIndex:"ttl",renderer:function(g){if(0==g){return""}else{return g}}},{text:"总金额",width:60,sortable:true,dataIndex:"priceTotal",renderer:function(g){if(0==g){return""}else{return g}}},{text:"品类数量",width:60,sortable:true,dataIndex:"cidQuantity",renderer:function(g){if(0==g){return""}else{return g}}},{text:"品类金额",width:60,sortable:true,dataIndex:"cidPrice",renderer:function(g){if(0==g){return""}else{return g}}},{text:"数量占比",width:70,sortable:false,dataIndex:"quantityPercent"},{text:"金额占比",width:70,sortable:false,dataIndex:"pricePercent"}],exportExcel:function(){var g=new Ext.LoadMask(document.body,{msg:"正在导出，请稍候",removeMask:true});g.show();Ext.Ajax.request({disableCaching:true,url:path("/download/generateAreaSale.json"),method:"POST",params:{category1:Ext.getCmp("category").getValue(),storeId1:Ext.getCmp("storeId").getValue(),startTime1:Ext.getCmp("startTime").getRawValue(),endTime1:Ext.getCmp("endTime").getRawValue(),is_trade_close1:Ext.getCmp("is_trade_close").checked,sku1:Ext.getCmp("sku").getRawValue()},success:function(h){if(""==Ext.decode(h.responseText).result){Ext.Msg.alert("提示信息","无纪录！")}if("none"==Ext.decode(h.responseText).result){Ext.Msg.alert("提示信息","无纪录！")}else{window.location.href=path("/download/downAreaSale.json?filePath="+Ext.decode(h.responseText).result)}g.hide()},failure:function(h){g.hide()},timeout:600000})},initComponent:function(){var g=this;g.topDockedItems=[{xtype:"button",itemId:"btnEdit",height:24,text:"导出",iconCls:"icon-edit",handler:g.exportExcel}];g.setStore();g.callParent();g.store.on("beforeload",function(j,k){var m=Ext.getCmp("category").getValue();var h=Ext.getCmp("storeId").getValue();var l=Ext.getCmp("startTime").getRawValue();var i=Ext.getCmp("endTime").getRawValue();var o=Ext.getCmp("is_trade_close").checked;var n=Ext.getCmp("sku").getRawValue();new_params={category1:m,storeId1:h,startTime1:l,endTime1:i,is_trade_close1:o,sku1:n};Ext.apply(j.proxy.extraParams,new_params)});g.on("afterrender",function(i,h){i.view.getEl().on("scroll",function(m,l){var k=Ext.getCmp("areaSalePageId").body.dom;var j=Ext.getCmp("areaSalePageSummaryId").body.dom;k.scrollLeft=j.scrollLeft=l.scrollLeft})},this)},setStore:function(){var g=this;if(g.autoSetStore){g.store=Ext.create("Ext.data.Store",{model:g.model,autoLoad:this.autoLoadStore,remoteSort:false})}},listeners:{render:function(g){g.body.on("scroll",function(j){Ext.Msg.alert("tips","====");var i=Ext.getCmp("areaSalePageId").body.dom;var h=Ext.getCmp("areaSalePageSummaryId").body.dom;h.scrollLeft=i.scrollLeft},this,{buffer:100})}}});Ext.define("Smartec.page.AreaSaleSummary",{extend:"Smartec.reportGrid.Panel",model:AreaSalePageSummary,hideHeaders:true,columns:[{xtype:"rownumberer",text:"序号",width:40,sortable:false},{text:"品类",width:45,sortable:true,dataIndex:"cid"},{text:"型号",width:50,sortable:true,dataIndex:"matrn"},{text:" ",width:40,sortable:true,dataIndex:"quantity"},{text:"浙江",width:46,sortable:true,dataIndex:"pzj",renderer:function(g){if(null==g||""==g){return 0}else{return g}}},{text:"北京",width:46,sortable:true,dataIndex:"pbj",renderer:function(g){if(null==g||""==g){return 0}else{return g}}},{text:"广东",width:46,sortable:false,dataIndex:"pgd",renderer:function(g){if(null==g||""==g){return 0}else{return g}}},{text:"湖北",width:46,sortable:false,dataIndex:"phb",renderer:function(g){if(null==g||""==g){return 0}else{return g}}},{text:"四川",width:46,sortable:false,dataIndex:"psc",renderer:function(g){if(null==g||""==g){return 0}else{return g}}},{text:"成都",width:30,sortable:false,dataIndex:"cd",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"西安",width:30,sortable:false,dataIndex:"xa",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"兰州",width:30,sortable:false,dataIndex:"lz",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"昆明",width:30,sortable:false,dataIndex:"km",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"贵阳",width:30,sortable:false,dataIndex:"gy",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"重庆",width:30,sortable:false,dataIndex:"cq",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"武汉",width:30,sortable:false,dataIndex:"wh",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"南昌",width:30,sortable:false,dataIndex:"nc",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"郑州",width:30,sortable:true,dataIndex:"zz",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"长沙",width:30,sortable:true,dataIndex:"cs",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"北京",width:30,sortable:true,dataIndex:"bj",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"太原",width:30,sortable:true,dataIndex:"ty",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"济南",width:30,sortable:true,dataIndex:"jn",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"石家庄",width:30,sortable:true,dataIndex:"sjz",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"沈阳",width:30,sortable:true,dataIndex:"sy",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"长春",width:30,sortable:true,dataIndex:"cc",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"哈尔滨",width:30,sortable:false,dataIndex:"heb",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"杭州",width:30,sortable:false,dataIndex:"hz",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"合肥",width:30,sortable:false,dataIndex:"hf",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"上海",width:30,sortable:true,dataIndex:"sh",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"南京",width:30,sortable:true,dataIndex:"nj",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"无锡",width:30,sortable:true,dataIndex:"wx",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"宁波",width:30,sortable:true,dataIndex:"nb",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"佛山",width:30,sortable:true,dataIndex:"fs",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"南宁",width:30,sortable:true,dataIndex:"nn",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"福州",width:30,sortable:true,dataIndex:"fz",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"深圳",width:30,sortable:true,dataIndex:"sz",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"TTL",width:60,sortable:true,dataIndex:"ttl",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"总金额",width:60,sortable:true,dataIndex:"priceTotal",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"品类数量",width:60,sortable:true,dataIndex:"cidQuantity",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"品类金额",width:60,sortable:true,dataIndex:"cidPrice",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"数量占比",width:70,sortable:true,dataIndex:"quantityPercent",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}},{text:"金额占比",width:70,sortable:true,dataIndex:"pricePercent",renderer:function(h,i,g){if(g.get("quantity")=="数量"){return h}else{return""}}}],initComponent:function(){var g=this;g.callParent();g.store.on("beforeload",function(j,k){var m=Ext.getCmp("category").getValue();var h=Ext.getCmp("storeId").getValue();var l=Ext.getCmp("startTime").getRawValue();var i=Ext.getCmp("endTime").getRawValue();var o=Ext.getCmp("is_trade_close").checked;var n=Ext.getCmp("sku").getRawValue();new_params={category1:m,storeId1:h,startTime1:l,endTime1:i,is_trade_close1:o,sku1:n};Ext.apply(j.proxy.extraParams,new_params)})}})},create_gridBoth:function(){var g=Ext.create("Smartec.page.AreaSale",{id:"areaSalePageId",topBarHight:30,autoHeight:true,autoWidth:true,autoAdded:false,autoSetStore:true,autoScroll:true});var h=Ext.create("Smartec.page.AreaSaleSummary",{id:"areaSalePageSummaryId",topBarHight:0,autoHeight:true,autoWidth:true,autoAdded:false,autoSetStore:true,autoScroll:true});return Ext.create("Ext.panel.Panel",{title:"结果展示",layout:"border",id:"bothGridId",defaults:{split:true},closable:true,closeAction:"hide",items:[{xtype:"panel",region:"north",layout:"fit",height:"75%",items:g},{xtype:"panel",region:"center",layout:"fit",height:"25%",split:true,items:h}]});return this.bothGridPanel},create_index:function(){if(!this.mainTabPanel){var g=Ext.create("Bsh.report.areaSale.IndexView",{id:"indexView",plain:true,border:0,bodyPadding:"20px 50px 100px 20px",fieldDefaults:{labelWidth:120,padding:"10px 0 0 0"},items:[{xtype:"combo",fieldLabel:"品类",emptyText:"请选择...",emptyValue:"",typeAhead:true,name:"category",id:"category",store:d,displayField:"label",valueField:"value",padding:"0 0 10 0",width:300,queryMode:"local",forceSelection:true,typeAhead:true,listeners:{beforequery:function(k){var j=k.combo;if(!k.forceAll){var h=k.query;var i=new RegExp(".*"+h+".*");j.store.filterBy(function(l,n){var m=l.get(j.displayField);return i.test(m)});j.expand();return false}}}},{xtype:"combo",name:"storeId",id:"storeId",anchor:"30%",fieldLabel:"商家店铺",store:b,displayField:"label",valueField:"value"},{xtype:"datefield",name:"startTime",id:"startTime",fieldLabel:"开始时间",anchor:"30%",style:"margin-top:15px",format:"Y-m-d H:i:s",listeners:{select:function(h){Ext.getCmp("endTime").setMinValue(h.getValue())}}},{xtype:"datefield",name:"endTime",id:"endTime",fieldLabel:"结束时间",labelSeparator:"",anchor:"30%",format:"Y-m-d H:i:s",listeners:{select:function(k,j,i){var h=Ext.Date.add(new Date(this.value),Ext.Date.HOUR,23);h=Ext.Date.add(new Date(h),Ext.Date.MINUTE,59);h=Ext.Date.add(new Date(h),Ext.Date.SECOND,59);this.setValue(h);Ext.getCmp("startTime").setMaxValue(h)}}},{fieldLabel:"不包含交易关闭",xtype:"checkbox",name:"is_trade_close",id:"is_trade_close"},{fieldLabel:"SKU",xtype:"textfield",name:"sku",id:"sku"}]});this.mainTabPanel=Ext.create("Ext.tab.Panel",{id:"mainTab1",activeTab:0,autoHeight:true,layout:"fit",items:[{items:g,title:"27仓销售统计(3W)表查询"}]})}return this.mainTabPanel}};var b=Ext.create("Ext.data.Store",{fields:["label","value"],data:[{label:"西门子",value:"22511900"},{label:"博世",value:"22511920"}]});var d=Ext.create("Ext.data.Store",{fields:["value","label"],proxy:{type:"ajax",url:path("/sku/findCategory.json"),reader:{type:"json",root:"result"}},autoLoad:true});function f(){e.define();var g={createIndex:function(){return e.create_index()}};return g}c.$AreaSalePage=f()})(this);Ext.onReady(function(){Ext.tip.QuickTipManager.init();var a=$AreaSalePage.createIndex();Ext.getCmp("center").add(a);Ext.getBody().insertHtml("beforeEnd",'<form action="/bsh/download/downAreaSale.json" id="queryForm" name = "queryForm" method="post" ><input type="hidden" name="category1" id="category1" ><input type="hidden" name="storeId1" id="storeId1"><input type="hidden" name="startTime1" id="startTime1"><input type="hidden" name="endTime1" id="endTime1"><input type="hidden" name="is_trade_close1" id="is_trade_close1"><input type="hidden" name="sku1" id="sku1"></form>')});