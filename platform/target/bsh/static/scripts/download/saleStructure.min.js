(function(d){var f=d.$SaleStructureReport;var a={define:function(){Ext.require(["Ext.form.*","Ext.Img","Ext.tip.QuickTipManager","Ext.ux.FieldReplicator"]);Ext.define("Bsh.report.saleStructure.IndexView",{extend:"Ext.form.Panel",model:OperationHistory,plain:true,border:0,bodyPadding:"20px 50px 100px 20px",fieldDefaults:{labelWidth:120,padding:"10px 0 0 0"},items:[{xtype:"combo",fieldLabel:"品类",emptyText:"请选择...",emptyValue:"",typeAhead:true,name:"category",id:"category",store:e,displayField:"label",valueField:"value",padding:"0 0 10 0",width:300,queryMode:"local",forceSelection:true,typeAhead:true,listeners:{beforequery:function(j){var i=j.combo;if(!j.forceAll){var g=j.query;var h=new RegExp(".*"+g+".*");i.store.filterBy(function(k,m){var l=k.get(i.displayField);return h.test(l)});i.expand();return false}}}},{xtype:"combo",name:"storeId",id:"storeId",anchor:"30%",fieldLabel:"商家店铺",store:c,displayField:"label",valueField:"value"},{xtype:"datefield",name:"startTime",id:"startTime",fieldLabel:"开始时间",anchor:"30%",style:"margin-top:15px",format:"Y-m-d H:i:s"},{xtype:"datefield",name:"endTime",id:"endTime",fieldLabel:"结束时间",labelSeparator:"",anchor:"30%",format:"Y-m-d H:i:s",listeners:{select:function(j,i,h){var g=Ext.Date.add(new Date(this.value),Ext.Date.HOUR,23);g=Ext.Date.add(new Date(g),Ext.Date.MINUTE,59);g=Ext.Date.add(new Date(g),Ext.Date.SECOND,59);this.setValue(g)}}},{fieldLabel:"交易是否关闭",xtype:"checkbox",name:"is_trade_close",id:"is_trade_close"},{fieldLabel:"SKU",xtype:"textfield",name:"sku",id:"sku"},{xtype:"fieldset",title:"最新下载",margin:"5 5 5 5",defaultType:"displayfield",defaults:{layout:"vbox",border:false,bodyStyle:"padding:4px margin:4px",anchor:"-20"},items:[{fieldLabel:"下载时间",name:"operateTime",setValue:function(g){this.value=g;this.setRawValue(this.renderer(g));return this},renderer:function(g){if(g==null){return""}else{return Ext.Date.format(g,"Y-m-d H:i:s")}}},{fieldLabel:"下载用户",name:"operateOp"}]}],clearAll:function(g){return function(){g.getForm().reset()}},addExportTab:function(g){return function(){var k=Ext.getCmp("mainTab1");if(k){if(Ext.getCmp("alipayGridId")){var j=Ext.getCmp("alipayGridId").getStore();var l=Ext.getCmp("brand").getValue();var i=Ext.getCmp("startTime").getRawValue();var h=Ext.getCmp("endTime").getRawValue();new_params={store:store,startTime:i,endTime:h};Ext.apply(j.proxy.extraParams,new_params);j.load();k.setActiveTab(1);k.show()}else{k.add(a.create_grid()).show()}}}},exportExcel:function(){var g=new Ext.LoadMask(document.body,{msg:"正在导出，请稍候",removeMask:true});g.show();Ext.Ajax.request({disableCaching:true,url:path("/sale/generateSaleStructure.json"),method:"POST",params:{category1:Ext.getCmp("category").getValue(),storeId1:Ext.getCmp("storeId").getValue(),startTime1:Ext.getCmp("startTime").getRawValue(),endTime1:Ext.getCmp("endTime").getRawValue(),is_trade_close1:Ext.getCmp("is_trade_close").checked,sku1:Ext.getCmp("sku").getRawValue()},success:function(i){if(""==Ext.decode(i.responseText).result){Ext.Msg.alert("提示信息","无纪录！")}if("none"==Ext.decode(i.responseText).result){Ext.Msg.alert("提示信息","无纪录！")}else{var h=Ext.decode(i.responseText).result;if("session-invalidate"==h){console.info("session-invalidate");window.location.href=path("/login");return false}window.location.href=path("/sale/downSaleStructure.json?filePath="+h)}g.hide()},failure:function(h){g.hide()},timeout:600000})},initComponent:function(){var g=this;this.dockedItems=[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"btnEdit",text:"导出",handler:g.exportExcel},{xtype:"button",iconCls:"icon-clearAll",text:"清空",handler:g.clearAll(this)}]}];g.callParent();g.getForm().load({url:path("/operationHistory/lastedOperationLog.json?operationType=DOWNLOAD_SALE_STRUCTURE")})}})},create_index:function(){if(!this.mainTabPanel1){var g=Ext.create("Bsh.report.saleStructure.IndexView",{id:"indexView1",reader:new Ext.data.JsonReader({root:"result",model:"OperationHistory",successProperty:"success"})});this.mainTabPanel1=Ext.create("Ext.tab.Panel",{id:"mainTab1",activeTab:0,autoHeight:true,layout:"fit",items:[{items:g,title:"销售结构分析查询"}]})}return this.mainTabPanel1}};var c=Ext.create("Ext.data.Store",{fields:["label","value"],data:[{label:"西门子",value:"22511900"},{label:"博世",value:"22511920"}]});var e=Ext.create("Ext.data.Store",{fields:["value","label"],proxy:{type:"ajax",url:path("/sku/findCategory.json"),reader:{type:"json",root:"result"}},autoLoad:true});function b(){a.define();var g={createIndex:function(){return a.create_index()}};return g}d.$SaleStructureReport=b()})(this);Ext.onReady(function(){Ext.tip.QuickTipManager.init();var a=$SaleStructureReport.createIndex();Ext.getCmp("center").add(a);Ext.getBody().insertHtml("beforeEnd",'<form action="/bsh/sale/downSaleStructure.json" id="queryForm" name = "queryForm" method="post" ><input type="hidden" name="category1" id="category1" ><input type="hidden" name="storeId1" id="storeId1"><input type="hidden" name="startTime1" id="startTime1"><input type="hidden" name="endTime1" id="endTime1"><input type="hidden" name="is_trade_close1" id="is_trade_close1"><input type="hidden" name="sku1" id="sku1"></form>')});