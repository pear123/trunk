(function(e){var b=e.$AlipayQueryReport;var a={define:function(){Ext.require(["Ext.form.*","Ext.Img","Ext.tip.QuickTipManager","Ext.ux.FieldReplicator"]);Ext.define("Oms.Finance.AlipayQuery.IndexView",{extend:"Ext.form.Panel",clearAll:function(f){return function(){f.getForm().reset()}},addExportTab:function(f){return function(){var k=Ext.getCmp("mainTab1");if(k){if(Ext.getCmp("alipayGridId")){var j=Ext.getCmp("alipayGridId").getStore();var i=Ext.getCmp("orderNum").getValue();var l=Ext.getCmp("brand").getValue();var h=Ext.getCmp("startTime").getRawValue();var g=Ext.getCmp("endTime").getRawValue();new_params={store:store,startTime:h,endTime:g};Ext.apply(j.proxy.extraParams,new_params);j.load();k.setActiveTab(1);k.show()}else{k.add(a.create_grid()).show()}}}},exportExcel:function(){var f=new Ext.LoadMask(document.body,{msg:"正在导出，请稍候",removeMask:true});f.show();Ext.Ajax.request({disableCaching:true,url:path("/delivery/generateDeliveryReport.json"),method:"POST",params:{brandParam:Ext.getCmp("brand").getValue(),orderNumParam:Ext.getCmp("orderNum").getValue(),invoiceNoParam:Ext.getCmp("invoiceNo").getValue(),startTimeParam:Ext.getCmp("startTime").getRawValue(),endTimeParam:Ext.getCmp("endTime").getRawValue()},success:function(h){if(""==Ext.decode(h.responseText).result){Ext.Msg.alert("提示信息","无纪录！")}if("none"==Ext.decode(h.responseText).result){Ext.Msg.alert("提示信息","无纪录！")}else{var g=Ext.decode(h.responseText).result;if("session-invalidate"==g){console.info("session-invalidate");window.location.href=path("/login");return false}window.location.href=path("/delivery/exportDeliveryReport.json?filePath="+g)}f.hide()},failure:function(g){f.hide()},timeout:600000})},initComponent:function(){var f=this;this.dockedItems=[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"btnEdit",text:"导出",handler:f.exportExcel},{xtype:"button",iconCls:"icon-clearAll",text:"清空",handler:f.clearAll(this)}]}];f.callParent();f.getForm().load({url:path("/operationHistory/lastedOperationLog.json?operationType=DOWNLOAD_BILL")})}})},create_grid:function(){return Ext.create("Ext.alipayQuery.GridPanel",{id:"alipayGridId",topBarHight:30,autoHeight:true,autoWidth:true,autoAdded:false,autoSetStore:true,closable:true,closeAction:"hide"})},create_index:function(){if(!this.mainTabPanel1){var f=Ext.create("Oms.Finance.AlipayQuery.IndexView",{id:"indexView1",plain:true,border:0,bodyPadding:"20px 50px 100px 20px",fieldDefaults:{labelWidth:120,padding:"10px 0 0 0"},reader:new Ext.data.JsonReader({root:"result",model:"OperationHistory",successProperty:"success"}),items:[{xtype:"combo",name:"brand",id:"brand",anchor:"30%",fieldLabel:"商家店铺",store:d,displayField:"label",valueField:"value"},{xtype:"textfield",name:"orderNum",id:"orderNum",anchor:"30%",fieldLabel:"订单号",regex:/^\d*$/,regexText:"必须为数字"},{xtype:"textfield",name:"invoiceNo",id:"invoiceNo",anchor:"30%",fieldLabel:"发票号"},{xtype:"datefield",name:"startTime",id:"startTime",fieldLabel:"订单的创建时间",anchor:"30%",style:"margin-top:15px",format:"Y-m-d H:i:s",listeners:{select:function(g){Ext.getCmp("endTime").setMinValue(g.getValue())}}},{xtype:"datefield",name:"endTime",id:"endTime",fieldLabel:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",labelSeparator:"",anchor:"30%",format:"Y-m-d H:i:s",listeners:{select:function(j,i,h){var g=Ext.Date.add(new Date(this.value),Ext.Date.HOUR,23);g=Ext.Date.add(new Date(g),Ext.Date.MINUTE,59);g=Ext.Date.add(new Date(g),Ext.Date.SECOND,59);this.setValue(g)}}},{xtype:"fieldset",title:"最新下载",margin:"5 5 5 5",defaultType:"displayfield",defaults:{layout:"vbox",border:false,bodyStyle:"padding:4px margin:4px",anchor:"-20"},items:[{fieldLabel:"下载时间",name:"operateTime",setValue:function(g){this.value=g;this.setRawValue(this.renderer(g));return this},renderer:function(g){if(g==null){return""}else{return Ext.Date.format(g,"Y-m-d H:i:s")}}},{fieldLabel:"下载用户",name:"operateOp"}]}]});this.mainTabPanel1=Ext.create("Ext.tab.Panel",{id:"mainTab1",activeTab:0,autoHeight:true,layout:"fit",items:[{items:f,title:"发票与礼品寄送表查询"}]})}return this.mainTabPanel1}};var d=Ext.create("Ext.data.Store",{fields:["label","value"],data:[{label:"西门子",value:"22511900"},{label:"博世",value:"22511920"}]});function c(){a.define();var f={createIndex:function(){return a.create_index()}};return f}e.$AlipayQueryReport=c()})(this);Ext.onReady(function(){Ext.tip.QuickTipManager.init();var a=$AlipayQueryReport.createIndex();Ext.getCmp("center").add(a);Ext.getBody().insertHtml("beforeEnd",'<form action="/bsh/delivery/exportDeliveryReport.json" id="queryForm" name = "queryForm" method="post" ><input type="hidden" name="brandParam" id="brandParam" ><input type="hidden" name="invoiceNoParam" id="invoiceNoParam" ><input type="hidden" name="orderNumParam" id="orderNumParam" ><input type="hidden" name="startTimeParam" id="startTimeParam"><input type="hidden" name="endTimeParam" id="endTimeParam"></form>')});