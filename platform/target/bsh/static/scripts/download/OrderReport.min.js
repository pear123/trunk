(function(e){var b=e.$AlipayQueryReport;var a={define:function(){Ext.require(["Ext.form.*","Ext.Img","Ext.tip.QuickTipManager","Ext.ux.FieldReplicator"]);Ext.define("Oms.Finance.AlipayQuery.IndexView",{extend:"Ext.form.Panel",plain:true,border:0,bodyPadding:"20px 50px 100px 20px",fieldDefaults:{labelWidth:120,padding:"10px 0 0 0"},model:OperationHistory,items:[{xtype:"combo",name:"brand",id:"brand",anchor:"30%",fieldLabel:"商家店铺",store:d,displayField:"label",valueField:"value"},{xtype:"textfield",name:"orderNum",id:"orderNum",anchor:"30%",fieldLabel:"订单号",regex:/^\d*$/,regexText:"必须为数字"},{xtype:"datefield",name:"startTime",id:"startTime",fieldLabel:"订单的创建时间",anchor:"30%",style:"margin-top:15px",format:"Y-m-d H:i:s",listeners:{select:function(f){Ext.getCmp("endTime").setMinValue(f.getValue())}}},{xtype:"datefield",name:"endTime",id:"endTime",fieldLabel:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",labelSeparator:"",anchor:"30%",format:"Y-m-d H:i:s",listeners:{select:function(i,h,g){var f=Ext.Date.add(new Date(this.value),Ext.Date.HOUR,23);f=Ext.Date.add(new Date(f),Ext.Date.MINUTE,59);f=Ext.Date.add(new Date(f),Ext.Date.SECOND,59);this.setValue(f);Ext.getCmp("startTime").setMaxValue(f)}}},{xtype:"datefield",name:"alipayStartTime",id:"alipayStartTime",fieldLabel:"支付到账时间",anchor:"30%",style:"margin-top:15px",format:"Y-m-d H:i:s",listeners:{select:function(f){Ext.getCmp("alipayEndTime").setMinValue(f.getValue())}}},{xtype:"datefield",name:"alipayEndTime",id:"alipayEndTime",fieldLabel:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",labelSeparator:"",anchor:"30%",format:"Y-m-d H:i:s",listeners:{select:function(i,h,g){var f=Ext.Date.add(new Date(this.value),Ext.Date.HOUR,23);f=Ext.Date.add(new Date(f),Ext.Date.MINUTE,59);f=Ext.Date.add(new Date(f),Ext.Date.SECOND,59);this.setValue(f);Ext.getCmp("alipayStartTime").setMaxValue(f)}}},{xtype:"fieldset",title:"最新下载",margin:"5 5 5 5",defaultType:"displayfield",defaults:{layout:"vbox",border:false,bodyStyle:"padding:4px margin:4px",anchor:"-20"},items:[{fieldLabel:"下载时间",name:"operateTime",setValue:function(f){this.value=f;this.setRawValue(this.renderer(f));return this},renderer:function(f){if(f==null){return""}else{return Ext.Date.format(f,"Y-m-d H:i:s")}}},{fieldLabel:"下载用户",name:"operateOp"}]}],clearAll:function(f){return function(){f.getForm().findField("brand").reset();f.getForm().findField("orderNum").reset();f.getForm().findField("startTime").reset();f.getForm().findField("endTime").reset();f.getForm().findField("alipayStartTime").reset();f.getForm().findField("alipayEndTime").reset()}},addExportTab:function(f){},exportExcel:function(){var f=new Ext.LoadMask(document.body,{msg:"正在导出，请稍候",removeMask:true});f.show();Ext.Ajax.request({disableCaching:true,url:path("/order/generateOrderReport.json"),method:"POST",params:{orderNum1:Ext.getCmp("orderNum").getValue(),brand1:Ext.getCmp("brand").getValue(),startTime1:Ext.getCmp("startTime").getRawValue(),endTime1:Ext.getCmp("endTime").getRawValue(),alipayStartTime1:Ext.getCmp("alipayStartTime").getRawValue(),alipayEndTime1:Ext.getCmp("alipayEndTime").getRawValue()},success:function(h){if(""==Ext.decode(h.responseText).result){Ext.Msg.alert("提示信息","无纪录！")}if("none"==Ext.decode(h.responseText).result){Ext.Msg.alert("提示信息","无纪录！")}else{var g=Ext.decode(h.responseText).result;if("session-invalidate"==g){console.info("session-invalidate");window.location.href=path("/login");return false}window.location.href=path("/order/exportOrderReport.json?filePath="+g)}f.hide()},failure:function(g){f.hide()},timeout:600000})},initComponent:function(){var f=this;this.dockedItems=[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"btnEdit",text:"导出",handler:f.exportExcel},{xtype:"button",iconCls:"icon-clearAll",text:"清空",handler:f.clearAll(this)}]}];f.callParent();f.getForm().load({url:path("/operationHistory/lastedOperationLog.json?operationType=DOWNLOAD_ORDER")})}})},create_grid:function(){return Ext.create("Ext.alipayQuery.GridPanel",{id:"alipayGridId",topBarHight:30,autoHeight:true,autoWidth:true,autoAdded:false,autoSetStore:true,closable:true,closeAction:"hide"})},create_index:function(){if(!this.mainTabPanel1){var f=Ext.create("Oms.Finance.AlipayQuery.IndexView",{id:"indexView1",reader:new Ext.data.JsonReader({root:"result",model:"OperationHistory",successProperty:"success"})});this.mainTabPanel1=Ext.create("Ext.tab.Panel",{id:"mainTab1",activeTab:0,autoHeight:true,layout:"fit",items:[{items:f,title:"订单开票表查询"}]})}return this.mainTabPanel1}};var d=Ext.create("Ext.data.Store",{fields:["label","value"],data:[{label:"西门子",value:"22511900"},{label:"博世",value:"22511920"}]});function c(){a.define();var f={createIndex:function(){return a.create_index()}};return f}e.$AlipayQueryReport=c()})(this);Ext.onReady(function(){Ext.tip.QuickTipManager.init();var a=$AlipayQueryReport.createIndex();Ext.getCmp("center").add(a)});