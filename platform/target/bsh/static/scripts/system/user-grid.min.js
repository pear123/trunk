function converterOrderStatus(b,c,a){return messages["com.arvato.smartec.Constants.OrderStatus."+b+".message"]}function converterPayStatus(b,c,a){return messages["com.arvato.smartec.Constants.PayStatus."+b+".message"]}Ext.define("Smartec.user.UserGrid",{alias:"widget.usergrid",extend:"Smartec.grid.Panel",model:"User",columns:[{text:"id",dataIndex:"omsUserSysId",hidden:true},{text:"用户名",width:440,sortable:false,dataIndex:"omsUserId"},{text:"用户状态",width:430,sortable:false,dataIndex:"omsUserStatus"}],addUserHandle:function(){var a=this.up("gridpanel");if(Ext.getCmp("addUserWindow")){Ext.getCmp("addUserWindow").show()}else{Ext.create("Ext.Window",{title:"添加用户",width:700,height:400,layout:"fit",draggable:false,modal:true,id:"addUserWindow",listeners:{hide:function(c){var b=Ext.getCmp("allform").getForm();b.clearInvalid();b.reset()}},closeAction:"hide",items:[allform=new Ext.form.FormPanel({id:"allform",bodyPadding:20,autoScroll:true,items:[{fieldLabel:"用户名<span style=color:red>*</span>",xtype:"textfield",id:"omsUserId",name:"omsUserId",readOnlyCls:"disable",padding:"0 0 10 0",allowBlank:false,blankText:"不能为空",width:300,maxLength:50,maxLengthText:"最大长度不能超过50个字符!"},{fieldLabel:"电子邮件<span style=color:red>*</span>",xtype:"textfield",id:"omsUserEmail",name:"omsUserEmail",padding:"0 0 10 0",allowBlank:false,blankText:"不能为空",width:300,maxLength:50,maxLengthText:"最大长度不能超过50个字符!",regex:/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,regexText:"邮箱格式错误"},{fieldLabel:"用户密码<span style=color:red>*</span>",xtype:"textfield",id:"omsUserPassword",name:"omsUserPassword",inputType:"password",allowBlank:false,blankText:"不能为空",width:300,maxLength:8,maxLengthText:"最大长度不能超过8个字符!",minLength:8,minLengthText:"最小长度不能小于8个字符!"},{fieldLabel:"确认密码<span style=color:red>*</span>",xtype:"textfield",id:"omsUserPassWordConfirm",name:"omsUserPassWordConfirm",inputType:"password",width:300,vtype:"password",vtypeText:"两次密码不一致！",confirmTo:"omsUserPassword"},{fieldLabel:"角色(可多选)",xtype:"combo",id:"omsUserRole",name:"omsUserRole",store:userRole,width:500,displayField:"omsRoleName",valueField:"omsRoleSysId",editable:false,padding:"0 0 10 0",multiSelect:true,autoShow:true},{fieldLabel:"昵称",xtype:"textfield",id:"omsUserName",name:"omsUserName",padding:"0 0 10 0",width:300,maxLength:50,maxLengthText:"最大长度不能超过50个字符!"},{fieldLabel:"备注",xtype:"textarea",id:"omsUserRemark",name:"omsUserRemark",width:600,height:100,maxLength:300,maxLengthText:"客户描述的长度不能超过300字符",padding:"0 0 10 0"},{xtype:"displayfield",hidden:true,id:"statusValue",name:"omsUserStatus"},{xtype:"fieldcontainer",fieldLabel:"状态",width:300,defaultType:"radiofield",padding:"0 0 10 0",defaults:{flex:1},layout:"hbox",items:[{boxLabel:"启用",name:"size",inputValue:"1",id:"userStatusRadio1",checked:true},{boxLabel:"禁用",name:"size",inputValue:"0",id:"userStatusRadio2"}]},{xtype:"button",text:"保存",iconCls:"icon-ok",handler:a.saveUser}]})]}).show()}},saveUser:function(){if(allform.form.isValid()){var d=Ext.getCmp("omsUserId").getValue();var f=Ext.getCmp("omsUserEmail").getValue();var e=Ext.getCmp("omsUserPassword").getValue();var c=Ext.getCmp("omsUserRole").getValue();var g=Ext.getCmp("omsUserName").getValue();var a=Ext.getCmp("omsUserRemark").getValue();var b="";if(Ext.getCmp("userStatusRadio1").getValue()){b=Ext.getCmp("userStatusRadio1").inputValue}else{b=Ext.getCmp("userStatusRadio2").inputValue}Ext.Ajax.request({url:path("/user/saveUser.do"),params:{omsUserId:d,omsUserEmail:f,omsUserPassword:e,omsUserStore:"",omsUserRole:c,userName:g,omsUserName:a,size:b},success:function(h){var i=Ext.decode(h.responseText);if(i.result=="UserIdError"){Ext.Msg.alert(messages["ext.tips.error"],"用户id已存在！");return}else{if(i.result=="UserEmailError"){Ext.Msg.alert(messages["ext.tips.error"],"邮箱已存在已存在！");return}else{if(i.success){Ext.Msg.alert(messages["ext.tips.tip"],"添加成功！",function(k){Ext.getCmp("addUserWindow").hide();var j=Ext.getCmp("UserGridId");j.getStore().load()})}}}},failure:function(){Ext.Msg.alert(messages["ext.tips.error"],messages["ext.tips.errorMsg"])}})}else{Ext.Msg.alert(messages["ext.tips.error"],"填写的内容有误！")}},editUserHandle:function(){var b=this.up("gridpanel");var e=b.getSelectionModel();record=e.getSelection()[0];var a=record.get("omsUserSysId");var c=record.get("omsUserSysId");var d=false;if(Ext.getCmp("editUserWindow")){Ext.getCmp("editUserWindow").show()}else{Ext.create("Ext.Window",{title:"修改用户",width:800,height:300,resizable:true,maximizable:true,autoScroll:true,modal:true,constrain:true,draggable:false,id:"editUserWindow",items:[orderDetailTabPanel=Ext.create("Ext.panel.Panel",{autoScroll:true,items:[Ext.create("Ext.panel.Panel",{layout:"fit",items:[Ext.create("Ext.form.Panel",{url:path("/user/saveUser.do?cbModifyPass="+d+"&omsUserSysId="+a),id:"updateUser",padding:"0 0 0 20",reader:new Ext.data.JsonReader({root:"result",model:"User",successProperty:"success"}),bodyPadding:20,border:0,items:[{fieldLabel:"用户名<span style=color:red>*</span>",xtype:"textfield",id:"omsUserId"+a,name:"omsUserId",readOnly:true,readOnlyCls:"disable",padding:"0 0 10 0",allowBlank:false,blankText:"不能为空",width:300,maxLength:50,maxLengthText:"最大长度不能超过50个字符!"},{fieldLabel:"电子邮件<span style=color:red>*</span>",xtype:"textfield",id:"omsUserEmail"+a,name:"omsUserEmail",padding:"0 0 10 0",allowBlank:false,blankText:"不能为空",width:300,maxLength:50,maxLengthText:"最大长度不能超过50个字符!",regex:/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,regexText:"邮箱格式错误"},{fieldLabel:"操作",xtype:"checkbox",hideLable:true,name:"operatPwd",id:"operatPwd",boxLabel:"同时修改密码",listeners:{change:function(){if(this.checked){Ext.getCmp("omsUserPassword"+a).show();Ext.getCmp("omsUserPassWordConfirm"+a).show();d=true}else{Ext.getCmp("omsUserPassword"+a).hide();Ext.getCmp("omsUserPassWordConfirm"+a).hide();d=false}}}},{fieldLabel:"用户密码<span style=color:red>*</span>",xtype:"textfield",id:"omsUserPassword"+a,name:"omsUserPassword",inputType:"password",hidden:true,allowBlank:false,blankText:"不能为空",width:300,maxLength:8,maxLengthText:"密码长度为8位!",minLength:8,minLengthText:"密码长度为8位!"},{fieldLabel:"确认密码<span style=color:red>*</span>",xtype:"textfield",id:"omsUserPassWordConfirm"+a,name:"omsUserPassWordConfirm",inputType:"password",hidden:true,width:300,vtype:"password",vtypeText:"两次密码不一致！",confirmTo:"omsUserPassword"+a},{xtype:"displayfield",hidden:true,id:"omsUserRoleValue"+a,name:"omsUserRoles"},{fieldLabel:"角色(可多选)",xtype:"combo",id:"omsUserRole"+a,name:"omsUserRole",store:userRole,width:500,displayField:"omsRoleName",valueField:"omsRoleSysId",editable:false,padding:"0 0 10 0",multiSelect:true,queryMode:"local"},{fieldLabel:"昵称",xtype:"textfield",id:"omsUserName"+a,name:"omsUserName",padding:"0 0 10 0",width:300,maxLength:50,maxLengthText:"最大长度不能超过50个字符!"},{fieldLabel:"备注",xtype:"textarea",id:"omsUserRemark"+a,name:"omsUserRemark",width:600,height:100,maxLength:300,maxLengthText:"客户描述的长度不能超过300字符",padding:"0 0 10 0",name:"omsUserRemark"},{xtype:"displayfield",hidden:true,id:"statusValue"+a,name:"omsCustomerStatus"},{xtype:"fieldcontainer",fieldLabel:"状态",width:300,defaultType:"radiofield",padding:"0 0 10 0",defaults:{flex:1},layout:"hbox",items:[{boxLabel:"启用",name:"size"+a,inputValue:"1",id:"userStatusRadio1"+a,checked:true},{boxLabel:"禁用",name:"size"+a,inputValue:"0",id:"userStatusRadio2"+a}]},{xtype:"fieldcontainer",layout:"hbox",items:[{xtype:"button",text:"保存",iconCls:"icon-ok",handler:function(){if(this.up("panel").getForm().isValid()){this.up("panel").getForm().submit({success:function(f,h){var g=h.result.result;if(g.result=="UserIdError"){Ext.Msg.alert(messages["ext.tips.error"],"用户id已存在！");return}else{if(g.result=="UserEmailError"){Ext.Msg.alert(messages["ext.tips.error"],"邮箱已存在！");return}else{Ext.Msg.alert(messages["ext.tips.tip"],"修改成功！");b.getStore().load();Ext.getCmp("editUserWindow").close()}}},failure:function(){Ext.Msg.alert(messages["ext.tips.error"],messages["ext.tips.errorMsg"])}})}else{Ext.Msg.alert(messages["ext.tips.error"],"填写的内容有误!")}}}]}]})]})]})]}).show();Ext.getCmp("updateUser").getForm().load({url:path("/user/form.json?omsUserSysId="+a),success:function(j,k){var f=Ext.getCmp("omsUserRoleValue"+a).getValue();var i=f.split(",");var h=Ext.getCmp("omsUserRole"+a);h.setValue(i);var g=k.result.data.omsUserStatus;var m=Ext.getCmp("userStatusRadio1"+a);var l=Ext.getCmp("userStatusRadio2"+a);if(g=="1"){m.setValue(true)}else{l.setValue(true)}}})}},initComponent:function(){orderGridMe=this;var a=this;a.topDockedItems=[{xtype:"button",itemId:"btnAdd",height:24,text:"添加用户",iconCls:"icon-new",handler:a.addUserHandle},{xtype:"button",itemId:"btnEdit",disabled:true,height:24,text:"查看用户明细",iconCls:"icon-edit",handler:a.editUserHandle}];a.callParent();a.getSelectionModel().on("selectionchange",function(c,b){a.down("#btnEdit").setDisabled(!(b.length==1))});Ext.apply(Ext.form.VTypes,{password:function(d,c){if(c.confirmTo){var b=Ext.getCmp(c.confirmTo);return(d==b.getValue())}return true}})}});Ext.onReady(function(){Ext.create("Smartec.user.UserGrid",{id:"UserGridId"})});