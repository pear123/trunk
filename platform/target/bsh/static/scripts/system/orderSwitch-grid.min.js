function converterOrderStatus(b,c,a){return messages["com.arvato.smartec.Constants.OrderStatus."+b+".message"]}function converterPayStatus(b,c,a){return messages["com.arvato.smartec.Constants.PayStatus."+b+".message"]}var sysId="";var status="";Ext.define("Smartec.system.OrderSwitch",{alias:"widget.orderSwitchgrid",extend:"Smartec.grid.Panel",model:"OrderSwitch",columns:[{text:"id",dataIndex:"omsOrderSwitchSysId",hidden:true},{text:"所属商店",width:200,sortable:false,dataIndex:"storeId"},{text:"开关类型",width:300,sortable:false,dataIndex:"switchType"},{text:"开关状态",width:150,sortable:false,dataIndex:"status"},{text:"创建人",width:100,sortable:false,dataIndex:"createOp"},{text:"修改人",width:100,sortable:false,dataIndex:"updateOp"},{text:"创建时间",width:300,sortable:false,dataIndex:"createTime"},{text:"修改时间",width:300,sortable:false,dataIndex:"updateTime"}],searchOrderSwitchHandle:function(){var b=Ext.getCmp("switchStatus").getValue();var d=Ext.getCmp("switchType").getValue();var a=Ext.getCmp("omsStoreId").getValue();var c=this.up("gridpanel");c.getStore().load()},addOrderSwtichHandle:function(){var a=this.up("gridpanel");if(Ext.getCmp("addOmsOrderSwtichWindow")){Ext.getCmp("addOmsOrderSwtichWindow").show()}else{Ext.create("Ext.Window",{title:"添加开关",width:500,height:200,layout:"fit",draggable:false,modal:true,id:"addOmsOrderSwtichWindow",listeners:{hide:function(c){var b=Ext.getCmp("allform").getForm();b.clearInvalid();b.reset()}},closeAction:"hide",items:[allform=new Ext.form.FormPanel({id:"allform",bodyPadding:10,autoScroll:true,items:[{fieldLabel:"所属商店",xtype:"combo",id:"storeId",name:"storeId",store:orderSeniorStoreId,displayField:"label",valueField:"value",emptyText:"请选择商店...",emptyValue:"",allowBlank:false,blankText:"请选择商店",editable:false,width:350,value:""},{fieldLabel:"开关类型",xtype:"combo",id:"switchType",name:"switchType",store:orderSwitchType,displayField:"label",valueField:"value",emptyText:"请选择类型(可多选)",emptyValue:"",allowBlank:false,blankText:"不能为空",editable:false,multiSelect:true,autoShow:true,width:400,value:""},{xtype:"button",text:"保存",iconCls:"icon-orderCancel",handler:a.saveOmsOrderSwitch}]})]}).show()}},saveOmsOrderSwitch:function(){if(allform.form.isValid()){var a=Ext.getCmp("storeId").getValue();var b=Ext.getCmp("switchType").getValue();Ext.Ajax.request({url:path("/omsOrderSwitch/saveOmsOrderSwitch.json"),params:{storeId:a,switchType:b},success:function(d){var e=Ext.decode(d.responseText);var c=e.result;if(c!=null&&c!=""){Ext.Msg.alert(messages["ext.tips.tip"],c,function(){})}else{Ext.Msg.alert(messages["ext.tips.tip"],"添加成功！",function(g){var f=Ext.getCmp("OrderSwitchId");f.getStore().load();Ext.getCmp("addOmsOrderSwtichWindow").close()})}},failure:function(){Ext.Msg.alert(messages["ext.tips.error"],messages["ext.tips.errorMsg"])}})}else{Ext.Msg.alert(messages["ext.tips.error"],"填写的内容有误！")}},updateOrderSwitch:function(){Ext.MessageBox.show({title:messages["ext.system.omsOrderSwitch.confirm.message"],msg:messages["ext.system.omsOrderSwitch.description.message"],width:300,buttons:Ext.MessageBox.OKCANCEL,icon:Ext.MessageBox.INFO,fn:function(b,c){if(b=="ok"){var a="";if(status=="自动"){a="1"}else{if(status=="手动"){a="0"}}Ext.Ajax.request({url:path("/omsOrderSwitch/updateSwitchStatus.json"),params:{omsOrderSwitchSysId:sysId,status:a},success:function(d){var e=Ext.decode(d.responseText);if(e.success){Ext.Msg.alert(messages["ext.tips.tip"],messages["ext.system.omsOrderSwitch.success.message"],function(g){var f=Ext.getCmp("OrderSwitchId");f.getStore().load()})}else{Ext.Msg.alert(messages["ext.tips.error"],messages["ext.system.omsOrderSwitch.failure.message"])}},failure:function(){Ext.Msg.alert(messages["ext.tips.error"],messages["ext.tips.errorMsg"])}})}}})},initComponent:function(){orderGridMe=this;var a=this;a.topDockedItems=[{xtype:"button",itemId:"btnAdd",height:24,text:"新建开关",iconCls:"icon-new",handler:a.addOrderSwtichHandle},{xtype:"button",itemId:"btnHand",disabled:true,height:24,text:"设为手动",iconCls:"icon-edit",handler:a.updateOrderSwitch},{xtype:"button",itemId:"btnAuto",disabled:true,height:24,text:"设为自动",iconCls:"icon-edit",handler:a.updateOrderSwitch},"->",{xtype:"combo",id:"omsStoreId",name:"omsStoreId",readOnly:a.isReadOnly,store:orderStoreIdStore,displayField:"label",valueField:"value",emptyText:"所属商店",emptyValue:"",editable:false,width:130,value:""},{xtype:"combo",id:"switchType",name:"switchType",readOnly:a.isReadOnly,store:orderSwitchTypeAll,displayField:"label",valueField:"value",emptyText:"开关类型",emptyValue:"",editable:false,width:130,value:""},{xtype:"combo",id:"switchStatus",name:"switchStatus",readOnly:a.isReadOnly,store:orderSwitchStatus,displayField:"label",valueField:"value",emptyText:"开关状态",emptyValue:"",editable:false,width:130,value:""},{xtype:"button",itemId:"btnSearch",height:24,text:"查询",iconCls:"icon-select",handler:a.searchOrderSwitchHandle}];a.callParent();a.getSelectionModel().on("selectionchange",function(c,b){if(b.length==1){sysId=b[0].data.omsOrderSwitchSysId;status=b[0].data.status;if(b[0].data.status=="自动"){a.down("#btnHand").setDisabled(false)}else{if(b[0].data.status=="手动"){a.down("#btnAuto").setDisabled(false)}}}else{sysId="";status="";a.down("#btnHand").setDisabled(true);a.down("#btnAuto").setDisabled(true)}});a.store.on("beforeload",function(e,f){var d=Ext.getCmp("switchStatus").getValue();var g=Ext.getCmp("switchType").getValue();var c=Ext.getCmp("omsStoreId").getValue();var b={status:d,type:g,storeId:c};Ext.apply(e.proxy.extraParams,b)})}});Ext.onReady(function(){Ext.create("Smartec.system.OrderSwitch",{id:"OrderSwitchId"})});