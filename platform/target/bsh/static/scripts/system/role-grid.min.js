function converterOrderStatus(b,c,a){return messages["com.arvato.smartec.Constants.OrderStatus."+b+".message"]}function converterPayStatus(b,c,a){return messages["com.arvato.smartec.Constants.PayStatus."+b+".message"]}Ext.define("Smartec.role.RoleGrid",{alias:"widget.rolegrid",extend:"Smartec.grid.Panel",model:"Role",columns:[{text:"id",dataIndex:"omsRoleSysId",hidden:true},{text:field.omsRoleId,width:400,sortable:false,dataIndex:"omsRoleId"},{text:field.omsRoleName,width:400,sortable:false,dataIndex:"omsRoleName"},{text:field.omsRoleStatus,width:200,sortable:false,dataIndex:"omsRoleStatus"},{text:field.omsRoleDescription,width:400,sortable:false,dataIndex:"omsRoleDescription"}],addRoleHandle:function(){var d=this.up("gridpanel");if(Ext.getCmp("addRoleWindow")){Ext.getCmp("addRoleWindow").show();var e=Ext.getCmp("allform").getForm();var a=e.getFields();e.reset();for(var c=0,b=a.length;c<b;c++){a.getAt(c).clearInvalid()}}else{Ext.create("Ext.Window",{title:field.addRole,width:800,height:300,autoScroll:true,modal:true,constrain:true,resizable:true,maximizable:true,id:"addRoleWindow",closeAction:"hide",items:[allform=new Ext.form.FormPanel({id:"allform",bodyPadding:20,items:[{fieldLabel:field.ecOrganization,xtype:"combo",id:"ecOrganization",name:"ecOrganization",store:omsOrganizationlist,width:300,displayField:"label",valueField:"value",queryMode:"local",editable:false,value:"",padding:"0 0 5 0",allowBlank:false,blankText:"不能为空",emptyText:field.ecOrganization,emptyValue:""},{fieldLabel:field.omsRoleId,xtype:"textfield",id:"omsRoleId",name:"omsRoleId",padding:"0 0 5 0",allowBlank:false,blankText:"不能为空",width:300,maxLength:20,maxLengthText:"最大长度不能超过20个字符!",regex:/^[0-9|a-z|_|A-Z]+$/,regexText:"角色ID定义是无效的"},{xtype:"displayfield",value:messages.lessThanTW,padding:"0 0 5 0"},{fieldLabel:field.omsRoleName,xtype:"textfield",id:"omsRoleName",name:"omsRoleName",padding:"0 0 5 0",allowBlank:false,blankText:"不能为空",width:300,maxLength:50,maxLengthText:messages.lessThanFT},{xtype:"displayfield",padding:"0 0 5 0",value:"不超过50个字符"},{fieldLabel:field.omsRoleDescription,xtype:"textarea",id:"omsRoleDescription",name:"omsRoleDescription",width:500,height:80,maxLength:300,maxLengthText:"资源描述的长度不能超过300字符",padding:"0 0 5 0"},{fieldLabel:field.omsRoleResource,xtype:"combo",id:"omsRoleResource",name:"omsRoleResource",store:roleResource,width:500,maxHeight:200,displayField:"omsResourceName",valueField:"omsResourceSysId",editable:false,padding:"0 0 10 0",multiSelect:true,emptyText:field.omsRoleResource,emptyValue:""},{xtype:"fieldcontainer",fieldLabel:field.status,width:300,defaultType:"radiofield",padding:"0 0 10 0",defaults:{flex:1},layout:"hbox",items:[{boxLabel:field.able,name:"size",inputValue:"1",id:"omsRoleStatus",checked:true},{boxLabel:field.unable,name:"size",inputValue:"0"}]},{xtype:"fieldcontainer",layout:"hbox",items:[{xtype:"button",text:"保存",iconCls:"icon-ok",handler:d.saveRole}]}]})]}).show()}},saveRole:function(){if(allform.form.isValid()){var d=Ext.getCmp("ecOrganization").getValue();var a=Ext.getCmp("omsRoleId").getValue();var e=Ext.getCmp("omsRoleName").getValue();var c=Ext.getCmp("omsRoleDescription").getValue();var b=Ext.getCmp("omsRoleResource").getValue();var f=Ext.getCmp("omsRoleStatus").getGroupValue();Ext.Ajax.request({url:path("/role/saveRole.do"),params:{ecOrganization:d,omsRoleId:a,omsRoleName:e,omsRoleDescription:c,omsRoleResource:b,omsRoleStatus:f},success:function(g){var h=Ext.decode(g.responseText);if(h.result=="idError"){Ext.Msg.alert(messages["ext.tips.error"],"角色id已存在！");return}else{if(h.result=="nameError"){Ext.Msg.alert(messages["ext.tips.error"],"角色名称已存在！");return}else{if(h.result=="success"){Ext.Msg.alert(messages["ext.tips.tip"],"添加成功！",function(j){Ext.getCmp("addRoleWindow").hide();var i=Ext.getCmp("RoleGridId");i.getStore().load()})}else{Ext.Msg.alert(messages["ext.tips.error"],"添加失败，请重试！")}}}},failure:function(){Ext.Msg.alert(messages["ext.tips.error"],messages["ext.tips.errorMsg"])},waitMsg:"正在保存，请稍后...."})}else{Ext.Msg.alert(messages["ext.tips.error"],"填写的内容有误！")}},editRoleHandle:function(){var b=this.up("gridpanel");var c=b.getSelectionModel();record=c.getSelection()[0];var a=record.get("omsRoleSysId");if(Ext.getCmp("editRoleWindow")){Ext.getCmp("editRoleWindow").show()}else{Ext.create("Ext.Window",{title:"修改角色",width:800,height:300,resizable:true,maximizable:true,autoScroll:true,modal:true,constrain:true,draggable:false,id:"editRoleWindow",items:[orderDetailTabPanel=Ext.create("Ext.panel.Panel",{autoScroll:true,border:0,items:[Ext.create("Ext.panel.Panel",{border:0,layout:"fit",items:[Ext.create("Ext.form.FormPanel",{url:path("/role/updateRole.do"),id:"updateRole",padding:"0 0 0 20",reader:new Ext.data.JsonReader({root:"result",model:"Role",successProperty:"success"}),bodyPadding:20,border:0,items:[{xtype:"textfield",hidden:true,name:"omsRoleSysId",id:"omsRoleSysId"+a},{xtype:"displayfield",hidden:true,id:"ecOrganizationValue"+a,name:"ecOrganization"},{fieldLabel:"角色ID <span style=color:red>*</span>",xtype:"textfield",id:"omsRoleId"+a,name:"omsRoleId",padding:"0 0 5 0",allowBlank:false,readOnly:true,blankText:"不能为空",width:300,maxLength:20,maxLengthText:"最大长度不能超过20个字符!",regex:/^[0-9|a-z|_|A-Z]+$/,regexText:"资源定义ID是无效的"},{xtype:"displayfield",value:"不超过20个字节（数字，字母和下划线组成 ）",padding:"0 0 5 0"},{fieldLabel:"角色名称 <span style=color:red>*</span>",xtype:"textfield",id:"omsRoleName"+a,name:"omsRoleName",padding:"0 0 5 0",allowBlank:false,blankText:"不能为空",width:300,maxLength:50,maxLengthText:"最大长度不能超过50个字符!"},{xtype:"displayfield",padding:"0 0 5 0",value:"不超过50个字符"},{xtype:"displayfield",hidden:true,id:"omsRoleResourceValue"+a,name:"omsRoleResources"},{fieldLabel:"资源(可多选)",xtype:"combo",id:"omsRoleResource"+a,name:"omsRoleResource",store:roleResource,width:500,displayField:"omsResourceName",valueField:"omsResourceSysId",editable:false,padding:"0 0 10 0",multiSelect:true,queryMode:"local",autoShow:true,listeners:{dblclick:{element:"body",fn:function(){var e=Ext.getCmp("omsRoleResourceValue"+a).getValue();var f=e.split(",");var d=Ext.getCmp("omsRoleResource"+a);d.setValue(f)}}}},{fieldLabel:"角色描述",xtype:"textarea",id:"omsRoleDescription"+a,name:"omsRoleDescription",width:500,height:80,maxLength:300,maxLengthText:"角色描述的长度不能超过300字符",padding:"0 0 5 0"},{xtype:"displayfield",hidden:true,id:"statusValue"+a,name:"omsRoleStatus"},{xtype:"fieldcontainer",fieldLabel:"状态",width:300,defaultType:"radiofield",padding:"0 0 10 0",defaults:{flex:1},layout:"hbox",items:[{boxLabel:"启用",name:"size"+a,inputValue:"1",id:"omsRoleStatusRadio1"+a,checked:true},{boxLabel:"禁用",name:"size"+a,inputValue:"0",id:"omsRoleStatusRadio2"+a}]},{xtype:"fieldcontainer",layout:"hbox",items:[{xtype:"button",text:"保存",iconCls:"icon-ok",handler:function(){if(this.up("panel").getForm().isValid()){this.up("panel").getForm().submit({success:function(d,f){var e=f.result;if(e.result=="success"){Ext.Msg.alert(messages["ext.tips.tip"],"修改成功！",function(g){b.getStore().load();Ext.getCmp("editRoleWindow").close()})}else{if(e.result=="nameError"){Ext.Msg.alert(messages["ext.tips.error"],"角色名称已存在！");return}else{if(e.result=="idError"){Ext.Msg.alert(messages["ext.tips.error"],"角色id已存在！");return}}}},failure:function(){Ext.Msg.alert(messages["ext.tips.error"],"修改失败，请重试！")},waitMsg:"正在保存，请稍后...."})}else{Ext.Msg.alert(messages["ext.tips.error"],"填写的内容有误!")}}}]}]})]})]})]}).show()}Ext.getCmp("updateRole").getForm().load({url:path("/role/roleById.json?sysId="+a),success:function(d,f){var k="";var h=Ext.getCmp("ecOrganizationValue"+a).getValue();var e=Ext.getCmp("ecOrganization"+a);e.setValue(h);var n=Ext.getCmp("omsRoleResourceValue"+a).getValue();var j=n.split(",");var l=Ext.getCmp("omsRoleResource"+a);l.setValue(j);var m=Ext.getCmp("statusValue"+a).getValue();var i=Ext.getCmp("omsRoleStatusRadio1"+a);var g=Ext.getCmp("omsRoleStatusRadio2"+a);if(k=="1"){i.setValue(true);return}if(k=="0"){g.setValue(true);return}}})},initComponent:function(){orderGridMe=this;var a=this;a.topDockedItems=[{xtype:"button",itemId:"btnAdd",height:24,text:field.addRole,iconCls:"icon-new",handler:a.addRoleHandle},{xtype:"button",itemId:"btnEdit",disabled:true,height:24,text:field.viewRoleDetail,iconCls:"icon-edit",handler:a.editRoleHandle}];a.callParent();a.getSelectionModel().on("selectionchange",function(c,b){a.down("#btnEdit").setDisabled(!(b.length==1))})}});Ext.onReady(function(){Ext.create("Smartec.role.RoleGrid",{id:"RoleGridId"})});