(function(b){var c=b.$Credential;var d={define:function(){Ext.apply(Ext.form.VTypes,{password:function(g,f){if(f.confirmTo){var e=Ext.getCmp(f.confirmTo);return(g==e.getValue())}return true},checkDuplicated:function(g,f){if(f.confirmTo){var e=Ext.getCmp(f.confirmTo);return !(g==e.getValue())}return false}})},create_index:function(){return Ext.create("Ext.panel.Panel",{title:"修改密码",width:400,height:500,modal:true,closable:false,border:true,frame:true,layout:"fit",items:{xtype:"form",id:"credentialForm",tbar:[{xtype:"button",text:"修改",handler:function(){var j=Ext.getCmp("credentialForm").getForm();if(!j.isValid()){Ext.Msg.alert(messages["ext.tips.tip"],"您的相关信息不符合要求，请重新输入");return}var h=this;h.setDisabled(true);var f=j.findField("username").getValue();var e=j.findField("oldPasswordWord").getValue();var g=j.findField("omsUserPassword").getValue();var i=j.findField("omsUserPassWordConfirm").getValue();Ext.Ajax.request({url:path("/user/updatePassword"),params:{omsUserId:f,oldPasswordWord:e,omsUserPassWord:g,omsUserPassWordConfirm:i},success:function(k){h.setDisabled(false);var l=Ext.decode(k.responseText);if(l.result==="NotEqualsOriginalPasscode"){Ext.Msg.alert(messages["ext.tips.error"],"原密码输入错误");return}else{if(l.result==="NotEqualsNewPasscode"){Ext.Msg.alert(messages["ext.tips.error"],"您输入的新旧密码不一致")}else{if(l.result==="ExistInRecentRecord"){Ext.Msg.alert(messages["ext.tips.error"],"您的新密码最近使用过，请更换其他密码")}else{if(l.result=="success"){Ext.Msg.alert(messages["ext.tips.tip"],"修改密码成功，请重新登录",function(m){window.location.href="${base}/bsh/j_spring_security_logout"})}}}}},failure:function(){h.setDisabled(false);Ext.Msg.alert(messages["ext.tips.error"],messages["ext.tips.errorMsg"])}})}},{xtype:"button",text:"返回",handler:function(){window.location.href=path("/j_spring_security_logout")}}],items:[{xtype:"displayfield",name:"username",id:"username",fieldLabel:"用&nbsp;&nbsp;&nbsp;户&nbsp;&nbsp;&nbsp;名",labelAlign:"right",value:'<font color="red">'+document.getElementById("username")?document.getElementById("username").value:"</font>"},{xtype:"password",fieldLabel:"原&nbsp;&nbsp;密&nbsp;&nbsp;码<span style=color:red>*</span>",xtype:"textfield",id:"oldPasswordWord",name:"oldPasswordWord",readOnlyCls:"disable",inputType:"password",allowBlank:false,blankText:"不能为空",width:300,labelAlign:"right",listeners:{blur:function(e){var f=e.getValue();if(f!=""){var g=Ext.getCmp("username").getValue();Ext.Ajax.request({url:"./validateOriginalPasscode",params:{username:g,passcode:f},success:function(h){var j=h.responseText;var i=Ext.decode(j);if(i.success===false){e.markInvalid("密码与用户名不匹配")}else{e.clearInvalid()}}})}}}},{fieldLabel:"新密码<span style=color:red>*</span>",xtype:"textfield",id:"omsUserPassword",name:"omsUserPassword",inputType:"password",allowBlank:false,blankText:"不能为空",labelAlign:"right",width:300,regex:new RegExp("^(?:(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*[^A-Za-z0-9])).{6,16}$"),invalidText:"密码必须包含大小写字母、数字以及特殊字符且长度为6-16位",maxLength:16,maxLengthText:"最大长度为16位",minLength:6,minLengthText:"最小长度为6位"},{fieldLabel:"确认密码<span style=color:red>*</span>",xtype:"textfield",id:"omsUserPassWordConfirm",name:"omsUserPassWordConfirm",inputType:"password",labelAlign:"right",width:300,allowBlank:false,blankText:"不能为空",vtype:"password",vtypeText:"两次密码不一致",confirmTo:"omsUserPassword"},{xtype:"form",layout:"column",width:300,border:false,items:[{columnWidth:0.6,fieldLabel:"验证码",xtype:"textfield",labelAlign:"right",id:"code",name:"code",allowBlank:false,blankText:"不能为空",listeners:{blur:function(e){var g=e.getValue();if(g!==""){var f=this;Ext.Ajax.request({url:"./validateCode",params:{code:g},success:function(h){var j=h.responseText;var i=Ext.decode(j);if(i.success===false){e.markInvalid("验证码有误")}else{e.clearInvalid()}}})}}}},{columnWidth:0.4,xtype:"label",html:'<img name="checkImg" id="vercodeimg" src="./captcha.jpg" style="cursor: pointer;margin-left: 10px" onclick="this.src=\'./captcha.jpg?update=new Date()\'" align="absmiddle">'}]}]}})}};function a(){d.define();var e={createIndex:function(){return d.create_index()}};return e}b.$Credential=a()})(this);Ext.onReady(function(){Ext.getBody().setStyle({backgroundColor:"lightgray"});var a=$Credential.createIndex();a.setHeight(Ext.getBody().getHeight()-20);a.render(Ext.getBody());a.showAt((Ext.getBody().getWidth()-a.getWidth())/2,0,true);window.onresize=function(){a.setWidth(400);a.setHeight(Ext.getBody().getHeight());a.doLayout()}});